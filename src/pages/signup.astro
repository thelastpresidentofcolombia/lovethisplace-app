---
import AuthLayout from "../layouts/AuthLayout.astro";
---

<AuthLayout title="Sign Up - LoveThisPlace">
    <div class="w-full max-w-md">
        <h1 class="font-display text-4xl font-bold text-center mb-2">
            Join the Founder's Circle
        </h1>
        <p class="text-center text-ink/70 dark:text-sand/70 mb-8">
            Create your account to claim your spot.
        </p>

        <form id="signup-form">
            <div class="space-y-4">
                <div>
                    <label for="email" class="block text-sm font-medium mb-1"
                        >Email</label
                    >
                    <input
                        type="email"
                        id="email"
                        required
                        class="w-full px-4 py-3 rounded-lg bg-sand/50 dark:bg-dark-bg/80 border border-ink/10 dark:border-sand/20 focus:ring-2 focus:ring-coral focus:outline-none transition"
                    />
                </div>
                <div>
                    <label for="password" class="block text-sm font-medium mb-1"
                        >Password</label
                    >
                    <input
                        type="password"
                        id="password"
                        required
                        minlength="6"
                        class="w-full px-4 py-3 rounded-lg bg-sand/50 dark:bg-dark-bg/80 border border-ink/10 dark:border-sand/20 focus:ring-2 focus:ring-coral focus:outline-none transition"
                    />
                </div>
            </div>

            <p
                id="error-message"
                class="text-red-500 text-sm text-center h-5 mt-4"
            >
            </p>

            <div class="mt-6">
                <button
                    type="submit"
                    id="submit-button"
                    class="w-full px-8 py-4 bg-coral text-white font-bold rounded-full transition-transform hover:scale-105"
                >
                    Create Account
                </button>
            </div>
        </form>

        <p class="text-center text-sm mt-6">
            Already have an account?
            <a href="/login" class="font-medium text-coral hover:underline"
                >Log in</a
            >
        </p>
    </div>
</AuthLayout>

<script>
    import { auth } from "../lib/firebase";
    import { createUserWithEmailAndPassword } from "firebase/auth";

    const form = document.getElementById("signup-form") as HTMLFormElement;
    const emailInput = document.getElementById("email") as HTMLInputElement;
    const passwordInput = document.getElementById(
        "password",
    ) as HTMLInputElement;
    const submitButton = document.getElementById("submit-button");
    const errorMessage = document.getElementById("error-message");

    form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const email = emailInput.value;
        const password = passwordInput.value;

        submitButton.setAttribute("disabled", "true");
        submitButton.textContent = "Creating Account...";
        errorMessage.textContent = "";

        try {
            const userCredential = await createUserWithEmailAndPassword(
                auth,
                email,
                password,
            );
            // On success, redirect to the dashboard
            window.location.href = "/dashboard";
        } catch (error) {
            // Handle errors
            if (error.code === "auth/email-already-in-use") {
                errorMessage.textContent = "This email is already in use.";
            } else {
                errorMessage.textContent =
                    "An error occurred. Please try again.";
            }
            console.error("Error creating user:", error);
            submitButton.removeAttribute("disabled");
            submitButton.textContent = "Create Account";
        }
    });
</script>
